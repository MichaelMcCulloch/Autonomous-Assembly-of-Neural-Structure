============================= test session starts ==============================
platform linux -- Python 3.12.11, pytest-8.4.1, pluggy-1.6.0
rootdir: /home/michael/Development/self-building-box/AANS
configfile: pyproject.toml
collected 6 items

tests/profiling/test_profile.py 
--- PyTorch Profiler Results (Learn Step, Top 15 CUDA time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  -------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                           Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  -------------------------------------  
                                        learn_step_call         0.00%       0.000us         0.00%       0.000us       0.000us     113.678ms       840.46%     113.678ms       2.842ms           0 b           0 b           0 b           0 b            40                                     []  
                                          aten::nonzero         1.67%       4.522ms         4.35%      11.784ms      58.921us       1.505ms        11.13%       1.520ms       7.602us           0 b           0 b       1.56 Mb           0 b           200                              [[80896]]  
void at_cuda_detail::cub::DeviceSelectSweepKernel<at...         0.00%       0.000us         0.00%       0.000us       0.000us       1.105ms         8.17%       1.105ms       3.158us           0 b           0 b           0 b           0 b           350                                     []  
                                          aten::nonzero         0.38%       1.025ms         1.10%       2.982ms      59.638us       1.080ms         7.99%       1.103ms      22.050us           0 b           0 b     799.22 Mb           0 b            50                         [[1024, 1024]]  
                                  Lazy Function Loading         2.18%       5.907ms         2.18%       5.907ms      15.424us     951.329us         7.03%     951.329us       2.484us           0 b           0 b           0 b           0 b           383                                     []  
void at::native::index_elementwise_kernel<128, 4, at...         0.00%       0.000us         0.00%       0.000us       0.000us     827.457us         6.12%     827.457us       2.069us           0 b           0 b           0 b           0 b           400                                     []  
void at::native::elementwise_kernel<128, 4, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us     812.353us         6.01%     812.353us       3.124us           0 b           0 b           0 b           0 b           260                                     []  
void at::native::reduce_kernel<512, 1, at::native::R...         0.00%       0.000us         0.00%       0.000us       0.000us     794.047us         5.87%     794.047us       3.970us           0 b           0 b           0 b           0 b           200                                     []  
                                              aten::sum         0.63%       1.706ms         0.99%       2.684ms      13.418us     697.631us         5.16%     701.279us       3.506us           0 b           0 b      12.50 Mb      12.50 Mb           200           [[1, 32, 32768], [], [], []]  
void at::native::reduce_kernel<128, 4, at::native::R...         0.00%       0.000us         0.00%       0.000us       0.000us     697.631us         5.16%     697.631us       3.488us           0 b           0 b           0 b           0 b           200                                     []  
                         Memcpy DtoH (Device -> Pinned)         0.00%       0.000us         0.00%       0.000us       0.000us     676.512us         5.00%     676.512us       0.846us           0 b           0 b           0 b           0 b           800                                     []  
                                              aten::mul         0.43%       1.157ms         0.72%       1.956ms       9.780us     634.082us         4.69%     634.082us       3.170us           0 b           0 b     400.00 Mb     400.00 Mb           200               [[1, 32, 32768], [1, 1]]  
void at::native::reduce_kernel<128, 4, at::native::R...         0.00%       0.000us         0.00%       0.000us       0.000us     529.729us         3.92%     529.729us       3.532us           0 b           0 b           0 b           0 b           150                                     []  
void at::native::index_elementwise_kernel<128, 4, at...         0.00%       0.000us         0.00%       0.000us       0.000us     499.715us         3.69%     499.715us       4.997us           0 b           0 b           0 b           0 b           100                                     []  
void at::native::(anonymous namespace)::write_indice...         0.00%       0.000us         0.00%       0.000us       0.000us     483.748us         3.58%     483.748us       9.675us           0 b           0 b           0 b           0 b            50                                     []  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  -------------------------------------  
Self CPU time total: 270.658ms
Self CUDA time total: 13.526ms

.
--- PyTorch Profiler Results (Learn Step, Top 15 CUDA time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ----------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                              Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ----------------------------------------  
                                        learn_step_call         0.00%       0.000us         0.00%       0.000us       0.000us     495.763ms        95.36%     495.763ms      12.394ms           0 b           0 b           0 b           0 b            40                                        []  
                                          aten::nonzero         0.17%       1.073ms         3.15%      19.468ms     389.368us     205.501ms        39.53%     205.501ms       4.110ms           0 b           0 b      78.12 Gb           0 b            50                          [[10240, 10240]]  
void at::native::(anonymous namespace)::write_indice...         0.00%       0.000us         0.00%       0.000us       0.000us     145.499ms        27.99%     145.499ms       2.910ms           0 b           0 b           0 b           0 b            50                                        []  
void at::native::index_elementwise_kernel<128, 4, at...         0.00%       0.000us         0.00%       0.000us       0.000us     123.484ms        23.75%     123.484ms       1.235ms           0 b           0 b           0 b           0 b           100                                        []  
                                            aten::index         0.11%     649.302us         3.33%      20.589ms     411.789us     123.377ms        23.73%     328.878ms       6.578ms           0 b           0 b       9.77 Gb     -68.36 Gb            50                      [[10240, 10240], []]  
void at_cuda_detail::cub::DeviceSelectSweepKernel<at...         0.00%       0.000us         0.00%       0.000us       0.000us      55.541ms        10.68%      55.541ms     158.688us           0 b           0 b           0 b           0 b           350                                        []  
void at::native::vectorized_elementwise_kernel<4, at...         0.00%       0.000us         0.00%       0.000us       0.000us      41.182ms         7.92%      41.182ms     137.272us           0 b           0 b           0 b           0 b           300                                        []  
                                             aten::add_         0.03%     174.840us         0.05%     330.030us       6.601us      40.088ms         7.71%      40.088ms     801.764us           0 b           0 b           0 b           0 b            50      [[10240, 10240], [10240, 10240], []]  
void at::native::vectorized_elementwise_kernel<4, at...         0.00%       0.000us         0.00%       0.000us       0.000us      23.169ms         4.46%      23.169ms     144.805us           0 b           0 b           0 b           0 b           160                                        []  
                                              aten::abs         0.05%     281.040us         0.11%     697.721us      13.954us      23.139ms         4.45%      23.139ms     462.775us           0 b           0 b       9.77 Gb           0 b            50                     [[10240, 10240], [0]]  
void at::native::vectorized_elementwise_kernel<4, at...         0.00%       0.000us         0.00%       0.000us       0.000us      23.139ms         4.45%      23.139ms     462.775us           0 b           0 b           0 b           0 b            50                                        []  
                                             aten::mul_         0.03%     201.460us         0.06%     372.600us       7.452us      23.051ms         4.43%      23.051ms     461.024us           0 b           0 b           0 b           0 b            50                      [[10240, 10240], []]  
void at::native::vectorized_elementwise_kernel<4, at...         0.00%       0.000us         0.00%       0.000us       0.000us      22.989ms         4.42%      22.989ms     153.262us           0 b           0 b           0 b           0 b           150                                        []  
                                             aten::div_         0.04%     270.320us         0.07%     457.401us       9.148us      22.873ms         4.40%      22.873ms     457.467us           0 b           0 b           0 b           0 b            50                      [[10240, 10240], []]  
                                              aten::max         0.08%     506.703us         0.18%       1.082ms      21.633us      18.764ms         3.61%      18.764ms     375.271us           0 b           0 b      25.00 Kb           0 b            50                             [[104847360]]  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ----------------------------------------  
Self CPU time total: 617.746ms
Self CUDA time total: 519.913ms

.
--- PyTorch Profiler Results (Forward Step, Top 15 CUDA time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                                  Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                               _advance_sequence_kernel         0.00%       0.000us         0.00%       0.000us       0.000us      35.170ms        97.94%      35.170ms     703.408us           0 b           0 b           0 b           0 b            50                                            []  
                                      forward_step_call         0.00%       0.000us         0.00%       0.000us       0.000us      28.849ms        80.33%      28.849ms     721.223us           0 b           0 b           0 b           0 b            40                                            []  
                         Memcpy DtoD (Device -> Device)         0.00%       0.000us         0.00%       0.000us       0.000us     284.098us         0.79%     284.098us       1.857us           0 b           0 b           0 b           0 b           153                                            []  
                                            aten::copy_         1.05%     451.470us         2.89%       1.244ms       8.294us     281.090us         0.78%     281.090us       1.874us           0 b           0 b           0 b           0 b           150                [[32, 32768], [32, 32768], []]  
                                               aten::mm         1.71%     735.972us         3.99%       1.719ms      34.379us     195.070us         0.54%     212.350us       4.247us           0 b           0 b      25.00 Kb      25.00 Kb            50                     [[32, 32768], [32768, 1]]  
                                               aten::mm         1.92%     825.273us         2.72%       1.170ms      23.398us     151.038us         0.42%     154.174us       3.083us           0 b           0 b     100.00 Mb     100.00 Mb            50                         [[32, 2], [2, 32768]]  
void cutlass::Kernel2<cutlass_80_wmma_tensorop_bf16_...         0.00%       0.000us         0.00%       0.000us       0.000us     151.038us         0.42%     151.038us       3.021us           0 b           0 b           0 b           0 b            50                                            []  
void dot_kernel<float, 128, 0, cublasDotParams<cubla...         0.00%       0.000us         0.00%       0.000us       0.000us     136.576us         0.38%     136.576us       2.732us           0 b           0 b           0 b           0 b            50                                            []  
                       Runtime Triggered Module Loading        19.44%       8.376ms        19.44%       8.376ms     837.564us      62.016us         0.17%      62.016us       6.202us           0 b           0 b           0 b           0 b            10                                            []  
void reduce_1Block_kernel<float, 128, 7, cublasGemvT...         0.00%       0.000us         0.00%       0.000us       0.000us      58.494us         0.16%      58.494us       1.170us           0 b           0 b           0 b           0 b            50                                            []  
                                              aten::add         1.09%     471.201us         1.63%     701.521us      14.030us      50.459us         0.14%      51.515us       1.030us           0 b           0 b      25.00 Kb      25.00 Kb            50                                [[32], [], []]  
void at::native::vectorized_elementwise_kernel<2, at...         0.00%       0.000us         0.00%       0.000us       0.000us      50.459us         0.14%      50.459us       1.009us           0 b           0 b           0 b           0 b            50                                            []  
                                  Lazy Function Loading         0.54%     231.120us         0.54%     231.120us      16.509us      46.752us         0.13%      46.752us       3.339us           0 b           0 b           0 b           0 b            14                                            []  
                                             aten::sort         0.10%      44.330us        10.31%       4.443ms       4.443ms      19.937us         0.06%      83.748us      83.748us           0 b           0 b      16.00 Kb       8.00 Kb             1                              [[1024], [], []]  
void at::native::radixSortKVInPlace<-2, -1, 32, 32, ...         0.00%       0.000us         0.00%       0.000us       0.000us      19.937us         0.06%      19.937us      19.937us           0 b           0 b           0 b           0 b             1                                            []  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
Self CPU time total: 43.075ms
Self CUDA time total: 35.912ms

.
--- PyTorch Profiler Results (Forward Step, Top 15 CUDA time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                                  Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                               _advance_sequence_kernel         0.00%       0.000us         0.00%       0.000us       0.000us     346.895ms        97.45%     346.895ms       6.938ms           0 b           0 b           0 b           0 b            50                                            []  
                                      forward_step_call         0.00%       0.000us         0.00%       0.000us       0.000us     276.178ms        77.58%     276.178ms       6.904ms           0 b           0 b           0 b           0 b            40                                            []  
                         Memcpy DtoD (Device -> Device)         0.00%       0.000us         0.00%       0.000us       0.000us       6.268ms         1.76%       6.268ms      41.510us           0 b           0 b           0 b           0 b           151                                            []  
                                            aten::copy_         0.13%     467.681us         0.36%       1.288ms       8.588us       6.267ms         1.76%       6.267ms      41.781us           0 b           0 b           0 b           0 b           150              [[32, 327680], [32, 327680], []]  
                                               aten::mm         0.22%     807.781us         2.51%       9.064ms     181.278us       1.345ms         0.38%       1.449ms      28.989us           0 b           0 b      25.00 Kb      25.00 Kb            50                   [[32, 327680], [327680, 1]]  
std::enable_if<!(false), void>::type internal::gemvx...         0.00%       0.000us         0.00%       0.000us       0.000us       1.260ms         0.35%       1.260ms      25.200us           0 b           0 b           0 b           0 b            50                                            []  
                                               aten::mm         0.26%     950.391us         0.42%       1.522ms      30.441us       1.250ms         0.35%       1.278ms      25.553us           0 b           0 b    1000.00 Mb    1000.00 Mb            50                        [[32, 2], [2, 327680]]  
void cutlass::Kernel2<cutlass_75_tensorop_bf16_s1688...         0.00%       0.000us         0.00%       0.000us       0.000us       1.250ms         0.35%       1.250ms      25.002us           0 b           0 b           0 b           0 b            50                                            []  
                                  Lazy Function Loading         0.04%     153.711us         0.04%     153.711us      19.214us     321.281us         0.09%     321.281us      40.160us           0 b           0 b           0 b           0 b             8                                            []  
                       Runtime Triggered Module Loading         3.73%      13.472ms         3.73%      13.472ms       2.245ms     292.096us         0.08%     292.096us      48.683us           0 b           0 b           0 b           0 b             6                                            []  
void cublasLt::splitKreduce_kernel<32, 16, int, floa...         0.00%       0.000us         0.00%       0.000us       0.000us      85.248us         0.02%      85.248us       1.705us           0 b           0 b           0 b           0 b            50                                            []  
                                              aten::add         0.14%     517.570us         0.20%     735.291us      14.706us      67.232us         0.02%      67.232us       1.345us           0 b           0 b      25.00 Kb      25.00 Kb            50                                [[32], [], []]  
void at::native::vectorized_elementwise_kernel<2, at...         0.00%       0.000us         0.00%       0.000us       0.000us      67.232us         0.02%      67.232us       1.345us           0 b           0 b           0 b           0 b            50                                            []  
                                             aten::sort         0.02%      74.810us         1.65%       5.942ms       5.942ms      60.000us         0.02%     540.960us     540.960us           0 b           0 b     160.00 Kb     160.00 Kb             1                             [[10240], [], []]  
void at_cuda_detail::cub::DeviceRadixSortOnesweepKer...         0.00%       0.000us         0.00%       0.000us       0.000us      45.279us         0.01%      45.279us       5.660us           0 b           0 b           0 b           0 b             8                                            []  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
Self CPU time total: 360.817ms
Self CUDA time total: 355.971ms

.
--- PyTorch Profiler Results (Full Loop, Top 20 CUDA time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                                  Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                                         full_iteration         0.00%       0.000us         0.00%       0.000us       0.000us       6.164ms       474.63%       6.164ms       6.164ms           0 b           0 b           0 b           0 b             1                                            []  
                               _advance_sequence_kernel         0.00%       0.000us         0.00%       0.000us       0.000us     668.225us        51.45%     668.225us     668.225us           0 b           0 b           0 b           0 b             1                                            []  
                                             aten::sort         0.31%      22.410us         0.98%      71.930us      71.930us      79.968us         6.16%      84.352us      84.352us           0 b           0 b      11.99 Mb      11.99 Mb             1                           [[1047543], [], []]  
void at_cuda_detail::cub::DeviceRadixSortOnesweepKer...         0.00%       0.000us         0.00%       0.000us       0.000us      62.592us         4.82%      62.592us      15.648us           0 b           0 b           0 b           0 b             4                                            []  
                                          aten::nonzero         0.88%      64.410us         2.27%     165.970us      55.323us      58.142us         4.48%      58.142us      19.381us           0 b           0 b      40.33 Mb           0 b             3                                [[1024, 1024]]  
void at_cuda_detail::cub::DeviceSelectSweepKernel<at...         0.00%       0.000us         0.00%       0.000us       0.000us      45.439us         3.50%      45.439us       3.787us           0 b           0 b           0 b           0 b            12                                            []  
void at::native::index_elementwise_kernel<128, 4, at...         0.00%       0.000us         0.00%       0.000us       0.000us      36.641us         2.82%      36.641us       2.155us           0 b           0 b           0 b           0 b            17                                            []  
                                          aten::nonzero         1.53%     111.900us         3.74%     273.381us      54.676us      36.543us         2.81%      36.543us       7.309us           0 b           0 b      42.50 Kb           0 b             5                                     [[80896]]  
void at::native::index_elementwise_kernel<128, 4, at...         0.00%       0.000us         0.00%       0.000us       0.000us      31.039us         2.39%      31.039us       4.434us           0 b           0 b           0 b           0 b             7                                            []  
                         Memcpy DtoD (Device -> Device)         0.00%       0.000us         0.00%       0.000us       0.000us      28.798us         2.22%      28.798us       1.800us           0 b           0 b           0 b           0 b            16                                            []  
void at::native::(anonymous namespace)::write_indice...         0.00%       0.000us         0.00%       0.000us       0.000us      24.928us         1.92%      24.928us       8.309us           0 b           0 b           0 b           0 b             3                                            []  
                         Memcpy DtoH (Device -> Pinned)         0.00%       0.000us         0.00%       0.000us       0.000us      22.399us         1.72%      22.399us       0.830us           0 b           0 b           0 b           0 b            27                                            []  
                                             aten::sort         0.20%      14.860us         0.81%      59.140us      59.140us      20.769us         1.60%      24.353us      24.353us           0 b           0 b      17.00 Kb       8.50 Kb             1                              [[1033], [], []]  
void at::native::radixSortKVInPlace<-2, -1, 64, 32, ...         0.00%       0.000us         0.00%       0.000us       0.000us      20.769us         1.60%      20.769us      20.769us           0 b           0 b           0 b           0 b             1                                            []  
                                            aten::index         0.67%      49.241us         2.64%     192.911us      64.304us      19.551us         1.51%      61.245us      20.415us           0 b           0 b       5.86 Mb     -26.11 Mb             3                            [[1024, 1024], []]  
void at::native::elementwise_kernel<128, 4, at::nati...         0.00%       0.000us         0.00%       0.000us       0.000us      16.736us         1.29%      16.736us       2.789us           0 b           0 b           0 b           0 b             6                                            []  
                                            aten::index         0.73%      53.500us         1.34%      98.230us      16.372us      15.008us         1.16%      15.008us       2.501us           0 b           0 b      35.00 Kb      35.00 Kb             6                                 [[80896], []]  
void at::native::reduce_kernel<512, 1, at::native::R...         0.00%       0.000us         0.00%       0.000us       0.000us      14.880us         1.15%      14.880us       3.720us           0 b           0 b           0 b           0 b             4                                            []  
void at_cuda_detail::cub::DeviceReduceKernel<at_cuda...         0.00%       0.000us         0.00%       0.000us       0.000us      14.687us         1.13%      14.687us       1.632us           0 b           0 b           0 b           0 b             9                                            []  
                                              aten::sum         0.41%      30.210us         0.64%      46.710us      11.678us      13.440us         1.03%      13.440us       3.360us           0 b           0 b     256.00 Kb     256.00 Kb             4                  [[1, 32, 32768], [], [], []]  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
Self CPU time total: 7.318ms
Self CUDA time total: 1.299ms


--- Full iteration timing breakdown ---
CPU time (total): 7.31ms
CUDA time (total): 0.62ms
CPU overhead: 6.69ms (91.5% of total)
--- This should match test_performance.py latency (apples to apples) ---

--- PyTorch Profiler Results (Full Loop, Top 20 CPU time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                                  Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
                                         full_iteration        28.07%       2.054ms        99.95%       7.314ms       7.314ms       0.000us         0.00%     623.153us     623.153us           0 b           0 b       4.50 Kb     -72.91 Mb             1                                            []  
                                       cudaLaunchKernel        12.92%     945.733us        13.42%     981.973us       4.161us       0.000us         0.00%       1.215us       0.005us           0 b           0 b           0 b           0 b           236                                            []  
                                           Unrecognized        10.54%     771.393us        10.54%     771.393us     771.393us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b             1                                            []  
                                  cudaStreamSynchronize         6.09%     445.963us         6.09%     445.963us      13.514us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b            33                                            []  
                                        cudaMemcpyAsync         3.43%     251.171us         3.43%     251.171us       5.126us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b            49                                            []  
                                         cuLaunchKernel         3.36%     245.691us         3.36%     245.691us      35.099us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b             7                                            []  
                                          aten::nonzero         1.53%     111.900us         3.74%     273.381us      54.676us      36.543us         2.81%      36.543us       7.309us           0 b           0 b      42.50 Kb           0 b             5                                     [[80896]]  
                                            aten::empty         1.05%      76.650us         1.05%      76.650us       2.839us       0.000us         0.00%       0.000us       0.000us           0 b           0 b      49.00 Kb      49.00 Kb            27                      [[], [], [], [], [], []]  
                                          aten::nonzero         0.88%      64.410us         2.27%     165.970us      55.323us      58.142us         4.48%      58.142us      19.381us           0 b           0 b      40.33 Mb           0 b             3                                [[1024, 1024]]  
                                          aten::nonzero         0.79%      57.520us         1.77%     129.870us      43.290us      11.805us         0.91%      11.805us       3.935us           0 b           0 b       1.00 Kb           0 b             3                                         [[1]]  
                                    aten::empty_strided         0.75%      55.040us         0.75%      55.040us       2.752us       0.000us         0.00%       0.000us       0.000us          24 b          24 b      15.24 Mb      15.24 Mb            20                      [[], [], [], [], [], []]  
                                            aten::index         0.73%      53.500us         1.34%      98.230us      16.372us      15.008us         1.16%      15.008us       2.501us           0 b           0 b      35.00 Kb      35.00 Kb             6                                 [[80896], []]  
                                             aten::set_         0.71%      51.750us         0.71%      51.750us      51.750us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b             1                  [[1, 1047543], [1047543, 1]]  
                                            aten::index         0.67%      49.241us         2.64%     192.911us      64.304us      19.551us         1.51%      61.245us      20.415us           0 b           0 b       5.86 Mb     -26.11 Mb             3                            [[1024, 1024], []]  
                              aten::_local_scalar_dense         0.65%      47.900us         6.90%     505.152us      33.677us      12.480us         0.96%      12.480us       0.832us           0 b           0 b           0 b           0 b            15                                          [[]]  
                                            aten::index         0.63%      46.131us         1.06%      77.521us      15.504us      11.936us         0.92%      11.936us       2.387us           0 b           0 b      26.50 Kb      26.50 Kb             5                                  [[1033], []]  
                                               aten::mm         0.50%      36.670us         0.72%      52.480us      17.493us       7.456us         0.57%       7.456us       2.485us           0 b           0 b       6.04 Mb       6.04 Mb             3                         [[32, 1], [1, 32768]]  
                                  Lazy Function Loading         0.50%      36.240us         0.50%      36.240us      36.240us       1.215us         0.09%       1.215us       1.215us           0 b           0 b           0 b           0 b             1                                            []  
                                               aten::gt         0.48%      34.840us         0.74%      53.850us      10.770us       5.312us         0.41%       5.312us       1.062us           0 b           0 b       2.50 Kb       2.50 Kb             5                                      [[], []]  
                                          aten::resize_         0.46%      33.610us         0.46%      33.610us       2.101us       0.000us         0.00%       0.000us       0.000us           0 b           0 b      50.37 Mb      50.37 Mb            16                                 [[0], [], []]  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  --------------------------------------------  
Self CPU time total: 7.318ms
Self CUDA time total: 1.299ms

.
--- PyTorch Profiler Results (Full Loop, Top 20 CUDA time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                                   Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------  
                                         full_iteration         0.00%       0.000us         0.00%       0.000us       0.000us      52.186ms       110.73%      52.186ms      52.186ms           0 b           0 b           0 b           0 b             1                                             []  
void at::native::index_elementwise_kernel<128, 4, at...         0.00%       0.000us         0.00%       0.000us       0.000us      12.569ms        26.67%      12.569ms       1.571ms           0 b           0 b           0 b           0 b             8                                             []  
                                          aten::nonzero         0.13%      67.690us         8.83%       4.656ms       1.552ms      11.378ms        24.14%      11.378ms       3.793ms           0 b           0 b       3.95 Gb           0 b             3                               [[10240, 10240]]  
                                            aten::index         0.07%      36.030us         2.10%       1.107ms     369.078us       8.230ms        17.46%      17.074ms       5.691ms           0 b           0 b     432.00 Mb      -2.70 Gb             3                           [[10240, 10240], []]  
void at::native::(anonymous namespace)::write_indice...         0.00%       0.000us         0.00%       0.000us       0.000us       8.054ms        17.09%       8.054ms       2.685ms           0 b           0 b           0 b           0 b             3                                             []  
                               _advance_sequence_kernel         0.00%       0.000us         0.00%       0.000us       0.000us       7.344ms        15.58%       7.344ms       7.344ms           0 b           0 b           0 b           0 b             1                                             []  
void at::native::index_elementwise_kernel<128, 4, at...         0.00%       0.000us         0.00%       0.000us       0.000us       5.620ms        11.92%       5.620ms     295.774us           0 b           0 b           0 b           0 b            19                                             []  
                                            aten::index         0.03%      18.270us         0.06%      30.210us      15.105us       5.580ms        11.84%       5.580ms       2.790ms           0 b           0 b     256.00 Mb     256.00 Mb             2                               [[55051766], []]  
                                            aten::index         0.05%      24.270us        14.76%       7.787ms       3.894ms       4.332ms         9.19%       5.568ms       2.784ms           0 b           0 b     231.98 Mb    -567.94 Mb             2                              [[104847350], []]  
void at_cuda_detail::cub::DeviceSelectSweepKernel<at...         0.00%       0.000us         0.00%       0.000us       0.000us       4.094ms         8.69%       4.094ms     341.177us           0 b           0 b           0 b           0 b            12                                             []  
                                             aten::sort         0.05%      24.690us         0.15%      79.790us      79.790us       2.329ms         4.94%       2.451ms       2.451ms           0 b           0 b     192.00 Mb     192.00 Mb             1                           [[16777216], [], []]  
void at_cuda_detail::cub::DeviceRadixSortOnesweepKer...         0.00%       0.000us         0.00%       0.000us       0.000us       2.070ms         4.39%       2.070ms     517.538us           0 b           0 b           0 b           0 b             4                                             []  
                                          aten::nonzero         0.05%      25.990us        14.69%       7.748ms       7.748ms       1.236ms         2.62%       1.236ms       1.236ms           0 b           0 b     799.92 Mb           0 b             1                                  [[104847350]]  
void at::native::vectorized_elementwise_kernel<4, at...         0.00%       0.000us         0.00%       0.000us       0.000us     941.060us         2.00%     941.060us     156.843us           0 b           0 b           0 b           0 b             6                                             []  
                                             aten::add_         0.01%       3.620us         0.01%       6.860us       6.860us     917.156us         1.95%     917.156us     917.156us           0 b           0 b           0 b           0 b             1           [[10240, 10240], [10240, 10240], []]  
void at_cuda_detail::cub::DeviceReduceKernel<at_cuda...         0.00%       0.000us         0.00%       0.000us       0.000us     531.106us         1.13%     531.106us      59.012us           0 b           0 b           0 b           0 b             9                                             []  
                                              aten::max         0.04%      21.490us         0.09%      45.590us      22.795us     509.410us         1.08%     509.410us     254.705us           0 b           0 b       1.00 Kb           0 b             2                                  [[104847350]]  
void at::native::reduce_kernel<512, 1, at::native::R...         0.00%       0.000us         0.00%       0.000us       0.000us     508.770us         1.08%     508.770us     254.385us           0 b           0 b           0 b           0 b             2                                             []  
void at::native::vectorized_elementwise_kernel<4, at...         0.00%       0.000us         0.00%       0.000us       0.000us     466.050us         0.99%     466.050us      77.675us           0 b           0 b           0 b           0 b             6                                             []  
void at::native::vectorized_elementwise_kernel<4, at...         0.00%       0.000us         0.00%       0.000us       0.000us     464.673us         0.99%     464.673us     232.337us           0 b           0 b           0 b           0 b             2                                             []  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------  
Self CPU time total: 52.759ms
Self CUDA time total: 47.130ms


--- Full iteration timing breakdown ---
CPU time (total): 52.75ms
CUDA time (total): 39.71ms
CPU overhead: 13.04ms (24.7% of total)
--- This should match test_performance.py latency (apples to apples) ---

--- PyTorch Profiler Results (Full Loop, Top 20 CPU time) ---
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls                                   Input Shapes  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------  
                                  cudaStreamSynchronize        86.66%      45.719ms        86.66%      45.719ms       1.385ms       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b            33                                             []  
                                         full_iteration         4.34%       2.290ms        99.99%      52.755ms      52.755ms       0.000us         0.00%      39.712ms      39.712ms           0 b           0 b       2.50 Kb      -3.35 Gb             1                                             []  
                                       cudaLaunchKernel         2.11%       1.115ms         2.11%       1.115ms       4.443us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b           251                                             []  
                                        cudaMemcpyAsync         0.51%     271.200us         0.51%     271.200us       5.770us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b            47                                             []  
                                         cuLaunchKernel         0.46%     242.911us         0.46%     242.911us      40.485us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b             6                                             []  
                                           Unrecognized         0.35%     186.821us         0.35%     186.821us     186.821us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b             1                                             []  
                                          aten::nonzero         0.23%     120.030us         5.39%       2.842ms     568.360us      96.352us         0.20%      96.352us      19.270us           0 b           0 b     402.50 Kb           0 b             5                                    [[2416640]]  
                                            aten::empty         0.16%      85.330us         0.16%      85.330us       3.048us       0.000us         0.00%       0.000us       0.000us           0 b           0 b     256.35 Mb     256.35 Mb            28                       [[], [], [], [], [], []]  
                                        cudaMemsetAsync         0.16%      84.041us         0.16%      84.041us       3.232us       0.000us         0.00%       0.000us       0.000us           0 b           0 b           0 b           0 b            26                                             []  
                                          aten::nonzero         0.13%      67.690us         8.83%       4.656ms       1.552ms      11.378ms        24.14%      11.378ms       3.793ms           0 b           0 b       3.95 Gb           0 b             3                               [[10240, 10240]]  
                                    aten::empty_strided         0.11%      59.810us         0.11%      59.810us       2.991us       0.000us         0.00%       0.000us       0.000us          24 b          24 b     200.80 Mb     200.80 Mb            20                       [[], [], [], [], [], []]  
                              aten::_local_scalar_dense         0.11%      57.870us        43.47%      22.934ms       1.529ms      13.344us         0.03%      13.344us       0.890us           0 b           0 b           0 b           0 b            15                                           [[]]  
                                          aten::nonzero         0.10%      55.251us        15.74%       8.303ms       2.768ms      12.608us         0.03%      12.608us       4.203us           0 b           0 b       1.00 Kb           0 b             3                                          [[1]]  
                                            aten::index         0.10%      52.670us         0.17%      88.000us      14.667us      17.569us         0.04%      17.569us       2.928us           0 b           0 b     323.00 Kb     323.00 Kb             6                                [[2416640], []]  
                                            aten::index         0.09%      48.910us         0.15%      81.090us      16.218us      11.841us         0.03%      11.841us       2.368us           0 b           0 b     242.50 Kb     242.50 Kb             5                                  [[10250], []]  
                                               aten::gt         0.09%      46.260us         0.13%      69.220us      13.844us       6.400us         0.01%       6.400us       1.280us           0 b           0 b       2.50 Kb       2.50 Kb             5                                       [[], []]  
                                               aten::mm         0.08%      43.771us         0.12%      63.211us      21.070us      40.128us         0.09%      40.128us      13.376us           0 b           0 b      60.00 Mb      60.00 Mb             3                         [[32, 1], [1, 327680]]  
                                               aten::mm         0.07%      38.920us         0.48%     251.271us     251.271us      24.608us         0.05%      24.608us      24.608us           0 b           0 b      20.00 Mb      20.00 Mb             1                         [[32, 2], [2, 327680]]  
                                          aten::resize_         0.07%      37.210us         0.07%      37.210us       2.481us       0.000us         0.00%       0.000us       0.000us           0 b           0 b       4.92 Gb       4.92 Gb            15                                  [[0], [], []]  
                                            aten::index         0.07%      36.030us         2.10%       1.107ms     369.078us       8.230ms        17.46%      17.074ms       5.691ms           0 b           0 b     432.00 Mb      -2.70 Gb             3                           [[10240, 10240], []]  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ---------------------------------------------  
Self CPU time total: 52.759ms
Self CUDA time total: 47.130ms

.

============================== 6 passed in 9.88s ===============================
